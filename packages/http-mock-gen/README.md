# http mock 代码生成工具
> 基于openapi v3 生成 ts数据类型和http mock 数据代码。<br/>
> mock数据填充默认值。

## 安装:
```bash
yarn add @liangskyli/http-mock-gen --dev
```

# 生成方式:
## 1、CLI 命令方式（推荐）

```bash
yarn http-mock-gen -c ./mock.config.cli.ts
```

### 命令参数

| 参数               | 说明                     | 默认值 |
|------------------|------------------------|-----|
| -c, --configFile | mock数据生成配置文件 `配置参数见下面` |     |

## 命令参数 configFile mock数据生成配置文件参数属性
| 属性                     | 说明                                                                                                                                                           | 默认值                                                  |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| openapiPath            | openapi v3 YAML or JSON 格式的文件路径,需要自己根据业务逻辑生成                                                                                                                 |                                                      |
| mockDir                | mock文件夹所在目录                                                                                                                                                  | `./`                                                 |
| prettierOptions        | `生成文件格式化，默认取项目配置，该配置优先级更高，会合并覆盖项目prettier配置文件，如项目有prettier配置文件，这里无需配置，详情配置见` [prettier文档](https://github.com/prettier/prettier/blob/main/docs/options.md)    |                                                      |
| jsonSchemaFakerOptions | `生成mock 数据 faker配置参数，详情配置见` [json-schema-faker options文档](https://github.com/json-schema-faker/json-schema-faker/blob/HEAD/docs/README.md#available-options) | { alwaysFakeOptionals: true, fillProperties: false } |
| mockDataReplace        | `生成mock 数据处理函数，可以覆盖faker数据` (this: any, key: string, value: any) => any                                                                                      | undefined                                            |

- configFile mock数据生成配置文件示例
```ts
import type { IGenMockDataOpts } from '@liangskyli/http-mock-gen';

const config: IGenMockDataOpts = {
  mockDir: './',
  openapiPath: './openapi/openapiv3-example.json',
  jsonSchemaFakerOptions: {
    minItems: 1,
    maxItems: 1,
  },
  mockDataReplace: (key, value) => {
    if (typeof value === 'string') {
      return key;
    }
    if (typeof value === 'number') {
      return 0;
    }
    if (typeof value === 'boolean') {
      return false;
    }
    return value;
  },
};
export default config;

```

- openapi v3 YAML or JSON 格式的文件[示例](docs/openapiv3-example.json)，openapi需要自己根据业务逻辑生成。
- openapi v3 method 只支持 get post接口，只生成application/json响应数据
- 生成mock 数据结构，最终使用interface-mock-data.ts文件
- Mock 数据修改指引 [文档](docs/http-mock-modify-guide.md)

生成的interface-mock-data.ts 文件(不要手动修改这个文件)，用于http mock 功能。
```ts
// This file is auto generated by http-mock-gen, do not edit!
import { Request, Response } from 'express';
import CustomData from './custom-data';
import { getMockData } from '@liangskyli/http-mock-gen';

export default {
    'POST /v1/beta-round/delete': (req: Request, res: Response) => {
        const data = CustomData['/v1/beta-round/delete'];
        let json = getMockData(req, data) ?? { retCode: 0, retMsg: 'retMsg' };
        res.json(json);
    },
    'GET /v1/building/get-list': (req: Request, res: Response) => {
        const data = CustomData['/v1/building/get-list'];
        let json = getMockData(req, data) ?? {
            retCode: 0,
            retMsg: 'retMsg',
            data: { isFuLi: false, blockList: [{ isBindErp: false, buildingName: 'buildingName' }] },
        };
        res.json(json);
    },
};
```
